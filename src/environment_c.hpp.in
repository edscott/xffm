/* Changes to this file shall be overwritten upon execution of configure
 * script, as primary-environment.h.in file is processed on package construction.
 * You have been given fair warning. */

// NOTE: run configure script *after* modifying environment_c.hpp.i file 
//       for changes to take effect.
//       environment_c.hpp file will be reconstructed on execution of
//       configure script!

/* increment version number for MCS_SHM_PLUGIN_FILE on configuration changes
 * (i.e. adding or removing configuration environment variables) */
// MCS_SHM_PLUGIN_FILE depends on CONFIG_BUILD, so that CONFIG_BUILD id 
// should be incremented with each modification to rfm environment variables.
// For rodent Gamma: build is 5190 (see files.h)
// For rodent Delta-unstable: build is 5858 (see files.h)
// For rodent Core-unstable: build is 6203 (see files.h)
// For rodent Core-rc1: build is 6214a (see files.h)
// For rodent Core-rc3: build is 6335i (see files.h)

#ifndef ENVIRONMENT_C_HPP
#define ENVIRONMENT_C_HPP
#include "xffm+.h"
#include <glib.h>

// These defines are set by configuration script when librfm is installed.
@GNU_LS@
@GNU_CP@
@GNU_MV@
@GNU_LN@
@GNU_RM@
@GNU_SHRED@

////////////////////////////   Configuration files   /////////////////////////////////
//

#define DEFAULT_DESKTOP_DIR	USER_DIR,_("Desktop")
#define USER_DIR 		g_get_home_dir()
#define USER_PIXMAPS		g_get_user_config_dir(), "pixmaps"
#define USER_RFM_DIR            g_get_user_config_dir(),"rfm"
#define USER_RFM_CACHE_DIR      g_get_user_cache_dir(),"rfm"
#define USER_DBH_DIR		USER_RFM_DIR,"dbh"
#define USER_DBH_CACHE_DIR	USER_RFM_CACHE_DIR,"dbh"
#define SYSTEM_MODULE_DIR	PACKAGE_DATA_DIR,"rfm","rmodules"
#define RFM_THUMBNAIL_DIR 	USER_RFM_CACHE_DIR,"thumbnails"

//
// Environment configuration file (shared via MIT-shm)
#define MCS_FILE_NAME		"rfm-"CONFIG_BUILD
#define MCS_SHM_PLUGIN_FILE 	USER_RFM_DIR,MCS_FILE_NAME

// Keybind customization file	
#define KEYBINDINGS_FILE 	USER_RFM_DIR,"keybind-6224.xml"
#define KEYBINDINGS_SCHEMA 	SYSTEM_MODULE_DIR,"keybind.xsd"

typedef struct RfmProgramOptions{
    const gchar *option;
    const gchar *text;
    gboolean sensitive;
    const gchar **choices;
    gint choice_id;
}RfmProgramOptions;

typedef struct environ_t {
    const gchar *env_var;
    gchar *env_string;
    const gchar *env_text;
    const gchar **env_options;
} environ_t;

typedef struct environ_default_t {
    const gchar *env_var;
    const gchar *env_default;
}environ_default_t;

class environment_c {
    public:
        environment_c(void);
        ~environment_c(void);

        const gchar *get_envar_value(const gchar *);
        gboolean set_envar_value(const gchar *, const gchar *);
        gboolean apply_envar_value(const gchar *);
    private:
    public:
        void *get_ls_options(void);
        void *get_cp_options(void);
        void *get_mv_options(void);
        void *get_ln_options(void);
        void *get_rm_options(void);
        void *get_shred_options(void);

        environ_t  *get_environ(void);
        environ_default_t  *get_environ_default(void);
        void set_gtk_thread(GThread *);
        GThread *get_gtk_thread(void);
        void rfm_init(void);
        void rfm_init_env (void);
        void rfm_setenv (const gchar *, gchar *, gboolean);
        //gchar *get_text_editor_envar(const gchar *);
        
    private:
        gboolean check_envar_value(const gchar *, const gchar *);
        gboolean is_number (const gchar *);
        gint get_max_threads(void);
        GThread *gtk_thread;
        void my_mkdir(gchar *);
        const gchar *term_exec_option(const gchar *);
        void set_defaults(void);
        void create_directories(void);
        GHashTable *environ_hash;
};

//
//
enum {
    RFM_DOUBLE_CLICK_NAVIGATION,/* toggle */
    RFM_VERTICAL_TOOLBAR,       // boolean
    RFM_USE_GTK_ICON_THEME,     // fallback to default system gtk icon theme 
    RFM_DRAG_DOES_MOVE,         /* toggle */
    RFM_CONTENT_FOLDER_ICONS,
    RFM_ENABLE_TIPS,           /* toggle */
    RFM_ENABLE_LABEL_TIPS,           /* toggle */
    RFM_PREVIEW_IMAGE_SIZE,     // integer
    RFM_FIXED_FONT_SIZE,      /* size selector */
    RFM_VARIABLE_FONT_SIZE,      /* size selector */
    RFM_FIXED_FONT_FAMILY,      /* family selector */
    RFM_VARIABLE_FONT_FAMILY,      /* family selector */
    RFM_DEFAULT_ICON_SIZE,      /* size selector */
    TERMINAL_CMD,               /* path selector */
    EDITOR,                 /* path selector */
    RFM_MAXIMUM_COMPLETION_OPTIONS, 
    RFM_MAXIMUM_DIAGNOSTIC_LINES, 
    RFM_LOAD_TIMEOUT, 
    /* desktop:: */
    RFM_ENABLE_DESKTOP,         /* toggle */
    RFM_ENABLE_DESKTOP_DIAGNOSTICS,    /* toggle */
    RFM_NAVIGATE_DESKTOP,       /* toggle */
    RFM_DESKTOP_TOP_MARGIN,     /* spin button*/
    RFM_DESKTOP_BOTTOM_MARGIN,  /* spin button*/
    RFM_DESKTOP_RIGHT_MARGIN,   /* spin button*/
    RFM_DESKTOP_LEFT_MARGIN,    /* spin button*/
    RFM_DESKTOP_DIR,            /* path selector */
    RFM_DESKTOP_IMAGE,          /* path selector */
    RFM_DESKTOP_COLOR,          /* color selector desktop */
    RFM_ICONVIEW_COLOR,         /* color selector iconview */
    RFM_TRANSPARENCY,           /* opacity selector, iconview */

    RFM_PLUGIN_FLAGS,                   /*  */
    RFM_MODULE_FLAGS,                   /*  */

    RFM_TOOLBAR,
    RFM_PASTEBOARD_SERIAL,
    RFM_BOOKMARK_SERIAL,

    ///// core options ///////////////////////////////////////////////////////
    RFM_SHRED_FLAGS,                   /*  */
    RFM_LS_FLAGS,                   /*  */
    RFM_CP_FLAGS,                   /*  */
    RFM_MV_FLAGS,                   /*  */
    RFM_LN_FLAGS,                   /*  */
    RFM_RM_FLAGS,                   /*  */

    // core option parameters
    RFM_SHRED_iterations,	// combo type              
    RFM_SHRED_size,         	// combo type	        

#ifdef GNU_LS
    RFM_LS_ignore,  		// entry type
    RFM_LS_tabsize,  		// entry type 
    RFM_LS_blocksize,  		// entry type
    RFM_LS_hide,  		// entry type
    RFM_LS_width,  		// entry type
    RFM_LS_format, 		// combo type
    RFM_LS_istyle,		// combo type
    RFM_LS_qstyle,		// combo type
    RFM_LS_sort,		// combo type
    RFM_LS_time,		// combo type
    RFM_LS_tstyle,		// combo type
#endif
#ifdef GNU_CP
    RFM_CP_backup, 		// combo type      
    RFM_CP_suffix,		// combo type  
    RFM_CP_preserve,		// combo type        
    RFM_CP_no_preserve,		// combo type            
    RFM_CP_reflink, 		// combo type              
    RFM_CP_sparse,		// combo type           
#endif
#ifdef GNU_MV
    RFM_MV_backup,  		// combo type                  
    RFM_MV_suffix,  		// combo type                  
#endif
#ifdef GNU_LN
    RFM_LN_backup, 		// combo type                    
    RFM_LN_suffix, 		// combo type                  
#endif
#ifdef GNU_RM
    RFM_RM_interactive,  	// combo type                 
#endif

    SMB_USER,                   /* input text */
    SUDO_ASKPASS,
    SSH_ASKPASS,
    
    VERSION_CONTROL,		
    PWD,                        
    RFM_OPTIONS
};

#endif

